rest_calls:
  - path: '/{{tenant_id}}/oauth2/token'
    method: POST
    headers:
      Content-Type: application/x-www-form-urlencoded
    response_format: json
    payload_format: raw
    payload: 'grant_type=client_credentials&client_id={{client_id}}&resource=https://management.azure.com/&client_secret={{client_secret}}'
    response_translation:
      access_token: [token]
    retry_on_connection_error: true
    host: login.microsoftonline.com
    port: 443
    ssl: true

  - path: '/subscriptions/{{subscription_id}}/resourceGroups/{{resource_group}}/providers/Microsoft.Compute/virtualMachines/{{vm_name}}/instanceView?api-version=2021-03-01'
    method: GET
    headers:
      Authorization: 'Bearer {{token}}'
    payload_format: raw
    response_format: json
    retry_on_connection_error: true
    response_expectation:
      - [ 'statuses', 1, 'code', 'PowerState/stopped']
    host: management.azure.com
    port: 443
    ssl: true
